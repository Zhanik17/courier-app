<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∫—É—Ä—å–µ—Ä–∞</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h2 { margin-top: 40px; }
    .order { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px; }
    .completed { background: #f0f0f0; color: gray; }
    button { margin-top: 10px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∫—É—Ä—å–µ—Ä–∞</h1>

  <h2>üì¶ –¢–µ–∫—É—â–∏–µ –∑–∞–∫–∞–∑—ã</h2>
  <div id="inProgressOrders"></div>

  <h2>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
  <div id="completedOrders"></div>

  <script>
    // üîê Firebase –∫–æ–Ω—Ñ–∏–≥ ‚Äî —É–∂–µ –≤—Å—Ç–∞–≤–ª–µ–Ω!
    const firebaseConfig = {
      apiKey: "AIzaSyD1kE5rIkwelYqGLOhN7g1n7WL5J03gyqI",
      authDomain: "courier-app17.firebaseapp.com",
      databaseURL: "https://courier-app17-default-rtdb.firebaseio.com",
      projectId: "courier-app17",
      storageBucket: "courier-app17.appspot.com",
      messagingSenderId: "535358089364",
      appId: "1:535358089364:web:f8b3d3d4a9a24ebf34e2f3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = 'login.html';
      } else {
        const uid = user.uid;
        const ordersRef = db.ref("orders");

        ordersRef.on("value", snapshot => {
          const orders = snapshot.val();
          const inProgressDiv = document.getElementById("inProgressOrders");
          const completedDiv = document.getElementById("completedOrders");

          inProgressDiv.innerHTML = "";
          completedDiv.innerHTML = "";

          for (let id in orders) {
            const order = orders[id];
            if (order.courierId === uid) {
              const div = document.createElement("div");
              div.className = "order";
              if (order.status === "completed") {
                div.classList.add("completed");
              }

              div.innerHTML = `
                <p><strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${order.name}</p>
                <p><strong>–û—Ç–∫—É–¥–∞:</strong> ${order.from}</p>
                <p><strong>–ö—É–¥–∞:</strong> ${order.to}</p>
                <p><strong>–ß—Ç–æ –¥–æ—Å—Ç–∞–≤–∏—Ç—å:</strong> ${order.what}</p>
              `;

              if (order.status === "in-progress") {
                const btn = document.createElement("button");
                btn.textContent = "‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ";
                btn.onclick = () => {
                  db.ref("orders/" + id).update({
                    status: "completed"
                  });
                };
                div.appendChild(btn);
                inProgressDiv.appendChild(div);
              } else {
                completedDiv.appendChild(div);
              }
            }
          }
        });
      }
    });
  </script>
</body>
</html>
